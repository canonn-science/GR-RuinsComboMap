
<!DOCTYPE html>
<html>
<head>
	
	<title>Ruins Validation</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="leaflet.css" />
	<link rel="stylesheet" href="ruins.css" />
	<script src="scripts/leaflet.js"></script>
	<script src="scripts/jquery-3.1.1.min.js"></script>
	
</head>
<body>


<div id="mapid" style="width: 100%; height: 600px;"></div>
<script>
	window.ruins = {
		map:L.map('mapid', {
			center: [0,0],
			zoom: -20,
			crs: L.CRS.Simple
		}),
		mapControls:null,
		defaultImageBounds:[[0,0], [750,750]]
	}
	
	

	window.ruins.map.on('click', onMapClick);

	function onMapClick(e) {
		/*
	    popup.setLatLng(e.latlng)
	        .setContent("You clicked the map at " + e.latlng.toString())
	        .openOn(mymap);
	    */
	    
	    
	    document.getElementById('log').value = document.getElementById('log').value + '[' + e.latlng.lat + ',' + e.latlng.lng + ']\n';
	}



	$('.ruinbtn').click(function(e){
		var ruinid = $(this).attr('href').replace(/#/g,'');
		var ruincombo = ruinid.split('.')[1];
		ruinid = ruinid.split('.')[0];

		setMap(ruinid,ruincombo);
	});


	function setMap(id,combo){
		//Clear existing layers
		window.ruins.map.eachLayer(function (layer) {
			window.ruins.map.removeLayer(layer);
		});

		//Remove old map controls
		if(window.mapControls){
			window.mapControls.remove();
			window.mapControls = null;
		}

		window.ruins.map.fitBounds(window.ruins.defaultImageBounds);

		//Now build layers
		var baseLayers = {};
		var overlays = {};

		//Ruin layout
		var ruinMapLayer = L.imageOverlay('maps/' + id + '/layout.svg', window.ruins.defaultImageBounds, {
				minZoom: 0,
				maxZoom: 5,
				attribution: 'Ruins diagram by Zebarmy',
				tms: true,
				autoZIndex: false
			}).addTo(window.ruins.map);

		//Overlays
		var obeliskMapOverlay = L.imageOverlay('maps/' + id + '/cluster.a.obelisks.svg', window.ruins.defaultImageBounds, {
				minZoom: 0,
				maxZoom: 5,
				tms: true,
				zIndex: 500
			}).addTo(window.ruins.map);

		var numberMapOverlay = L.imageOverlay('maps/' + id + '/cluster.a.numbers.svg', window.ruins.defaultImageBounds, {
				minZoom: 0,
				maxZoom: 5,
				tms: true,
				zIndex: 700
			}).addTo(window.ruins.map);
		
	
		//Add obelisks (ultimately to come from a JSON file associated with the grouping)
		var obelisksGroupOverlay = L.layerGroup(obeliskMapOverlay);

		var polygon = addObeliskPoly('a',1,[448.578125,365.9375],0);
		obelisksGroupOverlay.addLayer(polygon);
		
		polygon = addObeliskPoly('a',2,[446.1875,367.765625],180);
		obelisksGroupOverlay.addLayer(polygon);


		obelisksGroupOverlay.addTo(window.ruins.map);

		//Controls and overlay options
		window.ruins.mapControls = L.control.layers({'Ruins':ruinMapLayer},{'Obelisks':obelisksGroupOverlay,'Numbering':numberMapOverlay},{collapsed:false,hideSingleBase:true})

		//window.ruins.mapControls = L.control.layers({'Ruins':ruinMapLayer},{collapsed:false,hideSingleBase:true})
		window.ruins.mapControls.addTo(window.ruins.map);
	}

	function addObeliskPoly(cluster,number,point,orientation){
		var p1 = null;
		var p2 = null;
		var p3 = null;

		if(orientation == 180){
			//orient up
			var p1 = point;
			
			var p2 = [p1[0]+2.6, p1[1]-1.5];

			var p3 = [p1[0]+2.6, p1[1]+1.5];
		}else{

			//orient down
			var p1 = point;
			
			var p2 = [p1[0]-2.6, p1[1]-1.5];

			var p3 = [p1[0]-2.6, p1[1]+1.5];
		}
	
		var polygon = L.polygon([
		    p1,
		    p2,
		    p3
		], {color: 'blue'});

		polygon.on('click', function(e) {
			alert('Obelisk ' + cluster + ' ' + number);
  		});

		return polygon;
	}

	setMap('alpha','AB');

	
</script>


<textarea id="log" style="width:100%; height:500px; display: none"></textarea>



</body>
</html>

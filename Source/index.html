
<!DOCTYPE html>
<html>
<head>
	
	<title>Guardian Ancient Ruins 2</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

	<link rel="stylesheet" href="ruins.css" />

	<script src="scripts/jquery-3.1.1.min.js"></script>
	<script src="scripts/jquery.panzoom.js"></script>
	<script src="scripts/jquery.popupoverlay.js"></script>

	
</head>

<body>
	<div id="main">
	    <section id="map">
	      <div class="parent">
	        <div class="panzoom" id="ruin-map">
				Loading
	        </div>
	      </div>
	      <script>

			$( document ).ready(function() {
			  	window.ruins = function(){
					this.options = {
						panzoom:$(".panzoom"),
						zoomIn: $("#zoom-in"),
						zoomOut: $("#zoom-out"),
						//zoomRange: $(".zoom-range"),
						reset: $("#zoom-reset")
					}

					this.panZoomComp = null;
					this.helper = {
						leadingZero : function(num) {
							if(num < 10){
								return '0' + num;
							}
							return num;
						}
					}
					this.obeliskSelected = function(type,group,number){
						$('#ruin_obelisk_data_obelisk').text(group.toUpperCase() + helper.leadingZero(number));

						$('#ruin_obelisk_data_object1').text('Thing 1');
						$('#ruin_obelisk_data_object2').text('Thing 2');
						$('#ruin_obelisk_data_scan').text('CAT 77');

						$('#ruin_obelisk_data').popup('show');
					}

					this.itemInteractionSelect = function(e){
						//Get the components
						var clicked = e.target.id.split('-');

						//obelisk-alpha-b-20
						if(clicked.length >= 4){
							if('obelisk' === clicked[0]){
								this.obeliskSelected(clicked[1],clicked[2],clicked[3]);
							}
							
						}


					}

					this.prepSVG = function(){
						var registerTouch = 0;
						//Mouse wheel zoom
						panZoomComp.parent().on('mousewheel.focal', function( e ) {
							e.preventDefault();
							var delta = e.delta || e.originalEvent.wheelDelta;
							var zoomOut = delta ? delta < 0 : e.originalEvent.deltaY > 0;
							panZoomComp.panzoom('zoom', zoomOut, {
							  increment: 0.1,
							  animate: false,
							  focal: e
							});
						});		


						//Touch specific event handling
			          	$('.ruin-obelisk').on('mousedown touchstart',function(e){
			          		registerTouch = 1;
			          	});
			          	$('.ruin-obelisk').on('touchmove',function(e){
			          		registerTouch = 0;
			          	})	          
			          	$('.ruin-obelisk').on('touchend',function(e){
			          		if(registerTouch == 0){
			          			e.preventDefault();
			          			return;
			          		}
			          		registerTouch = 0;
			          		itemInteractionSelect(e);
			          	});

			          	//Click handlers
			          	$('.ruin-obelisk').on('click',function(e){
			          		itemInteractionSelect(e);
			          	});

			          	//Pointer to visualize that the item can be "clicked"
			          	$('.ruin-obelisk').css( 'cursor', 'pointer' );

			          	//Ensure that non interactive items don't interefere
			          	$('.ruin-inactive').css('pointer-events','none');
					}

					this.setPanZoom = function(panZoomElement){
						panZoomComp = panZoomElement.panzoom({
							cursor: "-webkit-grab",
							minScale: 1,
							maxScale: 50,
							increment: 1,
							duration: 10,
							$zoomIn: options.zoomIn,
							$zoomOut: options.zoomOut,
							$zoomRange: options.zoomRange,
							$reset: options.reset,
							$set: panZoomElement
						});
					}

					this.changeRuinType = function(typeName,data){

						$.get("maps/" + typeName + ".svg", function(data) {
							//Empty and then set the data
							$('#ruin-map').empty().append(data.documentElement);

							setPanZoom(options.panzoom);
							prepSVG();

						});
					}

					/*
					this.testLog = function(data){
			        	$('#templog').val($('#templog').val() + '\n' + data);
			        }
			        */

			  		return this;
			  	}();

		        
		        //Set our popup element
		        $('#ruin_obelisk_data').popup();

		        //Bind our more control
		        $('#info_bar').on('click',function(e){
		        	if($('#info').hasClass('down')) {
			        	$('#info').addClass('up');
						$('#info').removeClass('down'); 
						//Change chevron
						$('#info_bar .chevron').html('&#x25BE');
					}else{
						$('#info').addClass('down');
						$('#info').removeClass('up'); 
						//Change chevron
						$('#info_bar .chevron').html('&#x25B4');
					}
		        })

		        window.ruins.changeRuinType('alpha');

		        //TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING 
		        //TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING 
		        //TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING 
		        //TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING 
		        //TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING 
		        //TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING 
		        //set_test_data

		        $('#set_test_data').on('click',function(e){
		        	var testAlphaObelisks = {

		        		'a':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1,19:1,20:1 },
		        		'b':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:0,9:1,10:0,11:0,12:1,13:0,14:1,15:1,16:1,17:1,18:1,19:1,20:1,21:1 },
		        		'c':{ 1:1,2:1,3:1,4:1,5:0,6:1,7:1,8:1,9:0,10:0,11:1,12:1,13:1,14:0 },
		        		'd':{ 1:1,2:1,3:1,4:1,5:0,6:1,7:1,8:1,9:0,10:0,11:1,12:1,13:1,14:0 },
		        		'e':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:0 },
		        		'f':{ 1:1,2:0,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1,19:1,20:1,21:1,22:1 },
		        		'g':{ 1:1,2:1,3:1,4:0 },
		        		'h':{ 1:0,2:0,3:1,4:1,5:1,6:0,7:0 },
		        		'i':{ 1:1,2:0,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1,19:1,20:1 },
		        		'j':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:0 },
		        		'k':{ 1:1,2:0,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1,19:1,20:1,21:1,22:1 },
		        		'l':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:0 },
		        		'm':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:0,9:1,10:1,11:1,12:1,13:1,14:1,15:0,16:0,17:1,18:1,19:1,20:1,21:1,22:1,23:0,24:1 },
		        		'n':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:0 },
		        		'o':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:0,14:0,15:1,16:1,17:1,18:1,19:1,20:1 },
		        		'p':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1 },
		        		'q':{ 1:1,2:0,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:0,12:0,13:1,14:1,15:1,16:1,17:1,18:1,19:1,20:0,21:1,22:1,23:1,24:1,25:1,26:1,27:1,28:1,29:1 }
		        	}



		        	var ruinInfo = {
		        		system:{
		        			name: $('#system_name').val(),
		        			body: $('#body_name').val(),
		        			coords: $('#coordinates').val()
		        		},
		        		ruin:{
		        			type:$('#ruin_type').val(),
		        			groups: {}
		        		}
		        	}

		        	//Add test group obelisks
		        	var groupList=$('#groups').val().split(',');
		        	$.each(groupList, function( index, groupId ) {
		        		groupId = groupId.toLowerCase();

		        		ruinInfo.ruin.groups[groupId] = testAlphaObelisks[groupId]
					});


		        	//testAlphaObelisks
		        	
		        	console.log(ruinInfo);
		        })
		        
		        $('#info_bar').click();		        
		      });    

	      </script>
	    </section>

		<section id="mapcontrols">
			<div id="zoom-in" class="button" title="Zoom In">&nbsp;</div>

			<div id="zoom-out" class="button" title="Zoom Out">&nbsp;</div>

			<div id="zoom-reset" class="button" title="Reset Zoom">&nbsp;</div>
		</section>    

		<div id="info" class="down">
			<h2 id="info_bar">
					<span class="chevron">&#x25B4</span> Information <span class="chevron">&#x25B4</span>
			</h2>
			<div class="panel">
				<div class="panel-section">
					<h3>Direct Test Only</h3>
					<form id="testing" action="#" method="post" onsubmit="return false;">

					    <fieldset>
					        <label for="system_name">
					            <span>System Name</span>
					            <input id="system_name" name="system_name" type="text" class="text-input" value="IC 2391 SECTOR ZE-A D101"/>
					        </label>

					        <label for="body_name">
					            <span>Body</span>
					            <input id="body_name" name="body_name" type="text" class="text-input" value="C 3" />
					        </label>

					        <label for="coordinates">
					            <span>Coordinates</span>
					            <input id="coordinates" name="coordinates" type="text" class="text-input" value="29.42, -59.54"/>
					        </label>
					    </fieldset>

					    <fieldset>
					    	<label for="ruin_type">
					            <span>Ruin Type</span>
					            <select id="ruin_type" name="ruin_type">
					            	<option value="alpha">Alpha</option>
					            	<!--
					            	<option value="beta">Beta</option>
					            	<option value="gamma">Gamma</option>
					            	-->
					            </select>
					        </label>

					        <label for="groups">
					            <span>Cluster Groups</span>
					            <input id="groups" name="groups" type="text" class="text-input" value="A,B,C,D,E,F,G"/>
					        </label>

					    </fieldset>

					    <fieldset>
					        <input type="button" id="set_test_data" value="Test">
					    </fieldset>

					    
					</form>

				</div>
				<div class="panel-section">
					<h3>Panel Section 2</h3>
				</div>

				<div class="panel-section">
					<h3>Panel Section 3</h3>
				</div>
			</div>

		</div>


	    <!--
	    <textarea id="templog" style="height:500px; width:100%"></textarea>
		-->

	</div>

	<!-- Pop up -->
	<div id="ruin_obelisk_data">

		<h1 id="ruin_obelisk_data_obelisk">Obelisk</h1>
		<HR>
		Object 1: <span id="ruin_obelisk_data_object1">object 1</span><BR>
		Object 2: <span id="ruin_obelisk_data_object2">object 2</span><BR>
		<HR>
		Scan: <span id="ruin_obelisk_data_scan">scan</span><BR>

		<button class="ruin_obelisk_data_close button">Close</button>
	</div>	

	

</body>
</html>

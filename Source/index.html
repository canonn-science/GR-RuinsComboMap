
<!DOCTYPE html>
<html>
<head>
	
	<title>Guardian Ancient Ruins 2</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

	<link rel="stylesheet" href="ruins.css" />

	<script src="scripts/jquery-3.1.1.min.js"></script>
	<script src="scripts/jquery.panzoom.js"></script>
	<script src="scripts/guardian.ruins.js"></script>
	<script src="scripts/jquery.popupoverlay.js"></script>


	
</head>

<body>
	<div id="main">
		<section id="systems">
			<table id="ruin-list">
				<tr>
					<th>System</th>
					<th>Type</th>
					<th>Body</th>
					<th>Coordinates</th>
				</tr>
			</table>
		</section>
	    <section id="map" style="display:none">
	      <div class="parent">
	        <div class="panzoom noselect" id="ruin-map">
				&nbsp;
	        </div>
	      </div>
	      <script>
			window.textMapping = {
				artifacts:{
					'orb':'Orb',
					'casket':'Casket',
					'tablet':'Tablet',
					'totem':'Totem',
					'relic':'Relic'
				}
			}


		  	/* Mapping Mapping Mapping Mapping Mapping Mapping Mapping Mapping Mapping  */
		  	/* Mapping Mapping Mapping Mapping Mapping Mapping Mapping Mapping Mapping  */
		  	/* Mapping Mapping Mapping Mapping Mapping Mapping Mapping Mapping Mapping  */

	      	function prepMapUI(){
			  	window.ruins = Guardian.getRuin({
			  		panzoom:$(".panzoom"), 
			  		
			  		onMapReady: function(type){
			  			//Hide all by default
			  			//window.ruins.groups.hideAll();
			  			//Show map
						$('#map').show();

						//Hide system panel
						$('#systems').hide();						
						
			  		},
			  		onObeliskSelected: onMapSelection,
			  		onNumberSelected: onMapSelection
			  	});

		        //Set our popup element
		        $('#ruin_obelisk_data').popup();

		        //Bind our more control
		        $('#info_bar').on('click',function(e){
		        	if($('#info').hasClass('down')) {
			        	showInfoBar();
					}else{
						hideInfoBar();
					}
		        });


				//Test handle obelisk items
				$('.obelisk-selection').css( 'cursor', 'pointer' );
				$('.obelisk-selection').on('click',function(e){
					//Get the obelisk and identify the data from the id
					var obData = e.target.parentElement.id.split('-');

					//Hide
					hideInfoBar();

					//Focus on the obelisk
					window.ruins.focusOnObelisk(obData[1],obData[2]);
				});
       

				//Handle the zoom controls manually 
				$("#zoom-in").on('click', function(){
					window.ruins.zoomIn();
				});

				$("#zoom-out").on('click', function(){
					window.ruins.zoomOut();
				});

				$("#zoom-reset").on('click', function(){
					window.ruins.zoomReset();
				});

				$("#ruin-select").on('click', function(){
					$('#map').hide();
					$('#systems').show();
				});


	      	}


	        function onMapSelection(type,group,number){
	        	var numDisplay = number;
	        	if(numDisplay < 9){
	        		numDisplay = '0' + numDisplay;
	        	}
	        	showScanData(group.toUpperCase() + numDisplay,'orb','relic','Culture 12');				
	  		}

	  		function showScanData(obelisk,object1,object2,data){
	  			//Display
	  			var objectOneDisplay = window.textMapping.artifacts[object1] || 'None';
	  			var objectTwoDisplay = window.textMapping.artifacts[object2] || 'None';

				//Testing
	  			$('#scan_obelisk').text(obelisk);
				$('#scan_object1').text(objectOneDisplay);
				$('#scan_object1icon').removeClass().addClass('object ' + object1);

				$('#scan_object2').text(objectTwoDisplay);
				$('#scan_object2icon').removeClass().addClass('object ' + object2);

				$('#scan_result').text(data);
				$('#ruin_obelisk_data').popup('show');		
	  		}

	        function showInfoBar(){
	        	$('#info').addClass('up');
				$('#info').removeClass('down'); 
				//Change chevron
				$('#info_bar .chevron').html('&#x25BE');
	        }

	        function hideInfoBar(){
				$('#info').addClass('down');
				$('#info').removeClass('up'); 
				//Change chevron
				$('#info_bar .chevron').html('&#x25B4');
	        }

	        function ruinSelected(ruinId,type){

	        	//Start by loading the map type
				window.ruins.setRuinType(type);
			
	        }




		  	/* Selection Selection Selection Selection Selection Selection Selection */
		  	/* Selection Selection Selection Selection Selection Selection Selection */
		  	/* Selection Selection Selection Selection Selection Selection Selection */
		  	/* Selection Selection Selection Selection Selection Selection Selection */

	        function getRuinList(){
		        $.getJSON("mock/systemoverview.json", function(systemList) {
					//Empty and then set the data
					$.each(systemList,function(index,system){
		        		$.each(system.ruins,function(rindex,ruin){
							        			
						$('#ruin-list').append([
						'<tr id="' + $('<div/>').text(ruin.ruinId + '-' + ruin.ruinTypeName).html() + '"">',
						    '<td>' + $('<div/>').text(system.systemName).html() + '</td>',
						    '<td>' + $('<div/>').text(ruin.ruinTypeName).html() + '</td>',
						    '<td>' + $('<div/>').text(ruin.bodyName).html() + '</td>',
						    '<td>' + $('<div/>').text(ruin.coordinates.join(',')).html() + '</td>',
						'</tr>'
						].join(''));

	        		});
	        	});
				});
				


				return;


	        	var systemData = '[{"systemId":23,"systemName":"COL 173 SECTOR AP-Q B21-2","ruins":[{"ruinId":58,"bodyName":"A 8","ruinTypeName":"Beta","coordinates":[-33.1039,-32.2718]},{"ruinId":59,"bodyName":"B 4","ruinTypeName":"Gamma","coordinates":[13.3300,-61.5500]},{"ruinId":60,"bodyName":"B 4","ruinTypeName":"Alpha","coordinates":[19.0100,-100.9600]},{"ruinId":61,"bodyName":"B 4","ruinTypeName":"Beta","coordinates":[-35.3193,-73.9108]}]},{"systemId":11,"systemName":"COL 173 SECTOR AV-N B23-5","ruins":[{"ruinId":18,"bodyName":"A 2","ruinTypeName":"Beta","coordinates":[42.8343,-175.6545]},{"ruinId":19,"bodyName":"A 2","ruinTypeName":"Beta","coordinates":[33.2757,-175.5038]},{"ruinId":20,"bodyName":"A 2","ruinTypeName":"Gamma","coordinates":[-18.7380,-135.5687]}]},{"systemId":15,"systemName":"COL 173 SECTOR CG-M B24-8","ruins":[{"ruinId":30,"bodyName":"A 4","ruinTypeName":"Gamma","coordinates":[-42.7780,130.3500]},{"ruinId":31,"bodyName":"A 4","ruinTypeName":"Gamma","coordinates":[-15.8330,-172.5550]},{"ruinId":32,"bodyName":"A 5","ruinTypeName":"Gamma","coordinates":[19.0369,155.2710]}]}]';

	        	var systemList = JSON.parse(systemData);

	        	
	        	
	        }

	        function prepSelectionUI(){
			  	$('#ruin-list').on('click',function(e){
			  		var clicked = $(e.target);
			  		var row = clicked.closest('tr');

			  		if(row[0].id){
				  		var idType=row[0].id.split('-');
				  		
				  		if(2 === idType.length){
							ruinSelected(idType[0] , idType[1].toLowerCase());
				  		}	
			  		}
			  		
			  	});
			  }

			$( document ).ready(function() {
				//Prep the UI's
			  	prepSelectionUI();
			  	prepMapUI();

			  	//Load system
			  	getRuinList();




				//Stop host div from blocking bottom div during testing
				$('img[alt^="www."]').parent().parent().css('width','25%').css('right',0);





		        //TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING 
		        //TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING 
		        //TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING 
		        //TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING 
		        //TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING 
		        //TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING TESTING 
		        //set_test_data

		        $('#set_test_data').on('click',function(e){
		        	var testAlphaObelisks = {

		        		'a':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1,19:1,20:1 },
		        		'b':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:0,9:1,10:0,11:0,12:1,13:0,14:1,15:1,16:1,17:1,18:1,19:1,20:1,21:1 },
		        		'c':{ 1:1,2:1,3:1,4:1,5:0,6:1,7:1,8:1,9:0,10:0,11:1,12:1,13:1,14:0 },
		        		'd':{ 1:1,2:1,3:1,4:1,5:0,6:1,7:1,8:1,9:0,10:0,11:1,12:1,13:1,14:0 },
		        		'e':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:0 },
		        		'f':{ 1:1,2:0,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1,19:1,20:1,21:1,22:1 },
		        		'g':{ 1:1,2:1,3:1,4:0 },
		        		'h':{ 1:0,2:0,3:1,4:1,5:1,6:0,7:0 },
		        		'i':{ 1:1,2:0,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1,19:1,20:1 },
		        		'j':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:0 },
		        		'k':{ 1:1,2:0,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1,19:1,20:1,21:1,22:1 },
		        		'l':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:0 },
		        		'm':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:0,9:1,10:1,11:1,12:1,13:1,14:1,15:0,16:0,17:1,18:1,19:1,20:1,21:1,22:1,23:0,24:1 },
		        		'n':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:0 },
		        		'o':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:0,14:0,15:1,16:1,17:1,18:1,19:1,20:1 },
		        		'p':{ 1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1 },
		        		'q':{ 1:1,2:0,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:0,12:0,13:1,14:1,15:1,16:1,17:1,18:1,19:1,20:0,21:1,22:1,23:1,24:1,25:1,26:1,27:1,28:1,29:1 }
		        	}

		        	var ruinInfo = {
		        		system:{
		        			name: $('#system_name').val(),
		        			body: $('#body_name').val(),
		        			coords: $('#coordinates').val()
		        		},
		        		ruin:{
		        			type:$('#ruin_type').val(),
		        			groups: {}
		        		}
		        	}

		        	//Clear existing gropus
		        	window.ruins.groups.clearGroups();
		        	//Add test group obelisks
		        	var groups=$('#groups').val();

					for (var i = 0, len = groups.length; i < len; i++) {
		        		groupId = groups[i].toLowerCase();
		        		ruinInfo.ruin.groups[groupId] = testAlphaObelisks[groupId]
		        		window.ruins.groups.addGroup(groupId,ruinInfo.ruin.groups[groupId]);
					};

					//Emulate map start
					window.ruins.groups.hideAll();

					//Show those added
					window.ruins.groups.showAll();

					//And close
					hideInfoBar();
		        });



		      });    

			
			

	      </script>

			<div id="mapcontrols" class="noselect">
				<div id="ruin-select" class="button" title="Ruin Selection">&nbsp;</div>

				<div id="zoom-in" class="button" title="Zoom In">&nbsp;</div>

				<div id="zoom-out" class="button" title="Zoom Out">&nbsp;</div>

				<div id="zoom-reset" class="button" title="Reset Zoom">&nbsp;</div>

				
			</div> 


		<div id="info" class="down">
			<h2 id="info_bar">
					<span class="chevron">&#x25B4</span> Information <span class="chevron">&#x25B4</span>
			</h2>
			<div class="panel">
				<div class="panel-section">
					<h3>Direct Test Only</h3>
					<form id="testing" action="#" method="post" onsubmit="return false;">

					    <fieldset>
					        <label for="system_name">
					            <span>System Name</span>
					            <input id="system_name" name="system_name" type="text" class="text-input" value="IC 2391 SECTOR ZE-A D101"/>
					        </label>

					        <label for="body_name">
					            <span>Body</span>
					            <input id="body_name" name="body_name" type="text" class="text-input" value="C 3" />
					        </label>

					        <label for="coordinates">
					            <span>Coordinates</span>
					            <input id="coordinates" name="coordinates" type="text" class="text-input" value="29.42, -59.54"/>
					        </label>
					    </fieldset>

					    <fieldset>
					    	<label for="ruin_type">
					            <span>Ruin Type</span>
					            <select id="ruin_type" name="ruin_type">
					            	<option value="alpha">Alpha</option>
					            	<!--
					            	<option value="beta">Beta</option>
					            	<option value="gamma">Gamma</option>
					            	-->
					            </select>
					        </label>

					        <label for="groups">
					            <span>Cluster Groups</span>
					            <input id="groups" name="groups" type="text" class="text-input" value="ABHMOPQ"/>
					        </label>

					    </fieldset>

					    <fieldset>
					        <input type="button" id="set_test_data" value="Test">
					    </fieldset>

					    
					</form>

				</div>
				<div class="panel-section">
					<h3>Scans</h3>
					<table id="obelisks">
						<tr>
							<th>Group/Obelisk</th>
							<th>Item 1</th>
							<th>Item 2</th>
							<th>Result</th>
						</tr>
						<tr id="focus-a-1" class="obelisk-selection">
							<td>A01</td><td>Urn</td><td>Casket</td><td>Biology 1</td>
						</tr>
						<tr id="focus-a-3" class="obelisk-selection">
							<td>A03</td><td>Thing 3</td><td>Thing 4</td><td>Culture 1</td>
						</tr>
						<tr id="focus-a-5" class="obelisk-selection">
							<td>A05</td><td>Thing 3</td><td>Thing 4</td><td>Culture 2</td>
						</tr>
						<tr id="focus-d-8" class="obelisk-selection">
							<td>D08</td><td>Thing 3</td><td>Thing 4</td><td>Culture 3</td>
						</tr>
						<tr id="focus-n-7" class="obelisk-selection">
							<td>N07</td><td>Thing 3</td><td>Thing 4</td><td>Biology 4</td>
						</tr>
						<tr id="focus-i-19" class="obelisk-selection">
							<td>I19</td><td>Thing 3</td><td>Thing 4</td><td>Culture 5</td>
						</tr>

					</table>
				</div>

			</div>

		</div>	


		<!-- Pop up -->
		<div id="ruin_obelisk_data">
			<div class="obelisk">
				<span id="scan_obelisk">Obelisk</span> - <span class="scan" id="scan_result">Scan</span>
			</div>

			<div id="scan_data_panel">	
				<div class="object" id="scan_object1icon">
					<div class="object1" id="scan_object1">Obelisk 1</div>
				</div>
				<div class="object" id="scan_object2icon">
					<div class="object2" id="scan_object2">Obelisk 2</div>
				</div>			
			</div>

			<div class="ruin_obelisk_data_close">&nbsp;</div>
		</div>

    </section>



	</div>

	

</body>
</html>
